# CASL2シミュレータ 仕様書

## 1. 概要
このCASL2シミュレータは、CASL2アセンブリ言語のプログラムをブラウザ上で実行するためのツールです。

## 2. システム要件
- 最新のウェブブラウザ（Chrome、Edge、Firefox等）
- JavaScript有効
- インターネット接続不要（オフライン実行可能）

## 3. 機能仕様
### 3.1 CASL2プログラムのアセンブル
- テキストエディタでのコード入力
- アセンブル時のエラー検出と表示

### 3.2 プログラムの実行
- 通常実行モード
- ステップ実行モード
- ブレークポイントの設定と解除

### 3.3 メモリとレジスタの管理
- メモリ: 65536ワード (16ビット)
- 汎用レジスタ: GR0 - GR7 (各16ビット)
- プログラムレジスタ (PR): 16ビット
- スタックポインタ (SP): 16ビット
- フラグレジスタ (FR): 3ビット (OF, SF, ZF)

### 3.4 ユーザーインターフェース
- プログラム入力エリア（コードエディタ）
- 実行制御ボタン (アセンブル、実行、ステップ実行、リセット)
- レジスタ表示・編集エリア
- メモリ表示・編集エリア
- 実行結果・出力エリア
- 入出力ログエリア
- 実行履歴表示エリア

### 3.5 デバッグ機能
- ブレークポイントの設定と解除
- ステップ実行
- レジスタとメモリの状態表示
- 実行履歴の表示
- 詳細なデバッグ情報の表示

### 3.6 入出力処理
- 標準入出力のシミュレーション
- 入出力ログの表示

### 3.7 スタック操作
- PUSH、POP命令のサポート
- RPUSH、RPOP命令のサポート

## 4. 技術仕様
### 4.1 フロントエンド
- HTML5
- CSS3 (Skeletonフレームワーク使用)
- JavaScript (ES6+)
- Web Components
- Canvas API (視覚化機能用、将来的な実装)

### 4.2 バックエンド
- 純粋なフロントエンド実装（サーバーサイド処理なし）

### 4.3 データ構造
- メモリ: Uint16Array
- レジスタ: 個別の変数またはUint16Array

### 4.4 主要クラスと関数
- CASL2Simulator: シミュレータのメインクラス
- CASL2Assembler: アセンブラ機能を提供するクラス
- CASL2Debugger: デバッグ機能を提供するクラス
- UIManager: ユーザーインターフェース管理を行うクラス

## 5. パフォーマンス要件
- アセンブル処理: 1000行のコードを1秒以内に処理
- 実行速度: 1秒間に少なくとも10000命令を実行可能

## 6. セキュリティ要件
- ユーザー入力のサニタイズ
- クロスサイトスクリプティング（XSS）対策

## 7. 拡張性
- 新しい命令の追加が容易な設計
- プラグインシステムの将来的な導入の可能性

## 8. ドキュメンテーション
- README.md: プロジェクト概要
- SPECIFICATION.md: 詳細仕様書（本文書）
- DEVELOPMENT.md: 開発者向けガイド
- HANDOVER.md: プロジェクト引き継ぎ文書
- IMPLEMENTATION_CHECKLIST.md: 実装チェックリストおよび進捗管理
- APIリファレンス（JSDocを使用して生成）

## 9. テスト要件
- Jest使用した単体テスト
- 統合テスト
- テストカバレッジ目標: 80%以上

## 10. 今後の拡張予定
- Canvas APIを使用した視覚化機能の追加
  - グラフィカルなメモリ表示
  - レジスタの状態変化のアニメーション
  - 実行フローの視覚化
- ユーザーインターフェースの大幅な改善
- パフォーマンスの最適化
- 隠しコマンド（MULA、MULL、DIVA、DIVL）の実装
- 複数のCASL2プログラムの同時実行と比較

注意: 実装の詳細な進捗状況については、IMPLEMENTATION_CHECKLIST.mdを参照してください。
